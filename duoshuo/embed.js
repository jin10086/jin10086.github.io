function ua_build_html(e){e=e.post;return ua_getIplocation(e)+'<span class="ua">'+ua_sskadmin(e.author)+'</span><span class="ua">'+ua_html(e.agent)+'</span><span class="ua">'+os_html(e.agent)+"</span>"}function ua_getIplocation(e){var t="",e=e.iplocation||"";return t=e?'<span class="ua"><span class="location">'+e+"</span></span>":t}function ua_sskadmin(e){var t="";return e.user_id==duoshuoQuery.short_name?t=ua_checkMobile()?'<span class="ua"><span class="sskadmin"><i class="fa fa-star"></i>博主</span></span><br><br>':'<span class="ua"><span class="sskadmin"><i class="fa fa-star"></i>博主</span></span>':ua_checkMobile()&&(t="<br><br>"),t}function ua_checkMobile(){return null==navigator.userAgent.match(/iPad/i)&&null!=navigator.userAgent.match(/iphone|android|phone|mobile|wap|netfront|x11|java|opera mobi|opera mini|ucweb|windows ce|symbian|symbianos|series|webos|sony|blackberry|dopod|nokia|samsung|palmsource|xda|pieplus|meizu|midp|cldc|motorola|foma|docomo|up.browser|up.link|blazer|helio|hosin|huawei|novarra|coolpad|webos|techfaith|palmsource|alcatel|amoi|ktouch|nexian|ericsson|philips|sagem|wellcom|bunjalloo|maui|smartphone|iemobile|spice|bird|zte-|longcos|pantech|gionee|portalmmm|jig browser|hiptop|benq|haier|^lct|320x320|240x320|176x220/i)}function ua_html(e){var t=new Array,s="";return s=(t=e.match(/FireFox\/([^\s]+)/gi))?'<span class="ua_firefox"><i class="fa fa-globe"></i> Mozilla FireFox '+t[0].split("/")[1]:(t=e.match(/Maxthon([\d]*)\/([^\s]+)/gi))?'<span class="ua_maxthon"><i class="fa fa-globe"></i> Maxthon '+t[0].split("/")[1]:(t=e.match(/BIDUBrowser([\d]*)\/([^\s]+)/gi))?'<span class="ua_ucweb"><i class="fa fa-globe"></i> 百度浏览器 '+t[0].split("/")[1]:(t=e.match(/UBrowser([\d]*)\/([^\s]+)/gi))||(t=e.match(/UCBrowser([\d]*)\/([^\s]+)/gi))?'<span class="ua_ucweb"><i class="fa fa-globe"></i> UCBrowser '+t[0].split("/")[1]:(t=e.match(/MetaSr/gi))?'<span class="ua_sogou"><i class="fa fa-globe"></i> 搜狗浏览器':(t=e.match(/2345Explorer/gi))?'<span class="ua_2345explorer"><i class="fa fa-globe"></i> 2345王牌浏览器':(t=e.match(/2345chrome/gi))?'<span class="ua_2345chrome"><i class="fa fa-globe"></i> 2345加速浏览器':(t=e.match(/LBBROWSER/gi))?'<span class="ua_lbbrowser"><i class="fa fa-globe"></i> 猎豹安全浏览器':(t=e.match(/MicroMessenger\/([^\s]+)/gi))?'<span class="ua_qq"><i class="fa fa-weixin"></i> 微信 '+t[0].split("/")[1]:(t=e.match(/QQBrowser\/([^\s]+)/gi))||(t=e.match(/QQ\/([^\s]+)/gi))?'<span class="ua_qq"><i class="fa fa-globe"></i> QQ浏览器 '+t[0].split("/")[1]:(t=e.match(/MiuiBrowser\/([^\s]+)/gi))?'<span class="ua_mi"><i class="fa fa-globe"></i> Miui浏览器 '+t[0].split("/")[1]:(t=e.match(/Chrome([\d]*)\/([^\s]+)/gi))?'<span class="ua_chrome"><i class="fa fa-globe"></i> Chrome '+t[0].split("/")[1]:(t=e.match(/safari\/([^\s]+)/gi))?'<span class="ua_apple"><i class="fa fa-globe"></i> Apple Safari '+t[0].split("/")[1]:(t=e.match(/Opera[\s|\/]([^\s]+)/gi))?'<span class="ua_opera"><i class="fa fa-globe"></i> Opera '+t[0].split("/")[1]:(t=e.match(/Trident\/7.0/gi))?'<span class="ua_ie"><i class="fa fa-globe"></i> Internet Explorer 11':(t=e.match(/MSIE\s([^\s|;]+)/gi))?'<span class="ua_ie"><i class="fa fa-globe"></i> Internet Explorer '+t[0]:'<span class="ua_other"><i class="fa fa-globe"></i> 其它浏览器',Mobile=ua_checkMobile()?"<br><br>":"",s+"</span>"+Mobile}function os_html(e){return(e.match(/win/gi)?e.match(/nt 5.1/gi)?'<span class="os_xp"><i class="fa fa-desktop"></i> Windows XP':e.match(/nt 6.1/gi)?'<span class="os_7"><i class="fa fa-desktop"></i> Windows 7':e.match(/nt 6.2/gi)?'<span class="os_8"><i class="fa fa-desktop"></i> Windows 8':e.match(/nt 6.3/gi)?'<span class="os_8_1"><i class="fa fa-desktop"></i> Windows 8.1':e.match(/nt 10.0/gi)?'<span class="os_8_1"><i class="fa fa-desktop"></i> Windows 10':e.match(/nt 6.0/gi)?'<span class="os_vista"><i class="fa fa-desktop"></i> Windows Vista':e.match(/nt 5/gi)?'<span class="os_2000"><i class="fa fa-desktop"></i> Windows 2000':'<span class="os_windows"><i class="fa fa-desktop"></i> Windows':e.match(/android/gi)?'<span class="os_android"><i class="fa fa-android"></i> Android':e.match(/ubuntu/gi)?'<span class="os_ubuntu"><i class="fa fa-desktop"></i> Ubuntu':e.match(/linux/gi)?'<span class="os_linux"><i class="fa fa-linux"></i> Linux':e.match(/mac/gi)?'<span class="os_mac"><i class="fa fa-desktop"></i> Mac OS X':e.match(/unix/gi)?'<span class="os_unix"><i class="fa fa-desktop"></i> Unix':e.match(/symbian/gi)?'<span class="os_nokia"><i class="fa fa-mobile"></i> Nokia SymbianOS':'<span class="os_other"><i class="fa fa-desktop"></i> 其它操作系统')+"</span>"}!function(g,C,b){function S(){return E.short_name?f+"//"+E.short_name+"."+U.DOMAIN:U.REMOTE}function j(){return 0==le.data.user_id}function s(e){"none"!=(U.theme=e)&&O.injectStylesheet(U.STATIC_URL+"/styles/embed"+(e?"."+e+".css?"+w[e]:"."+short_name)+".css")}var r,t,a,i,n,O={},o=C.getElementsByTagName("head")[0]||C.getElementsByTagName("body")[0];if(O.extend=function(e,t){for(var s in t)e[s]=t[s];return e},O.injectScript=function(e,s){var a=C.createElement("script"),i=C.head||C.getElementsByTagName("head")[0]||C.documentElement;a.type="text/javascript",a.src=e,a.async="async",a.charset="utf-8",s&&(a.onload=a.onreadystatechange=function(e,t){!t&&a.readyState&&!/loaded|complete/.test(a.readyState)||(a.onload=a.onreadystatechange=null,i&&a.parentNode&&i.removeChild(a),a=b,t||s.call(g))}),i.insertBefore(a,i.firstChild)},O.injectStylesheet=function(e){var t=C.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=e,o.appendChild(t)},O.injectStyle=function(e){var t=C.createElement("style");return t.type="text/css",o.appendChild(t),e=e.replace(/\}/g,"}\n"),t.styleSheet?t.styleSheet.cssText=e:t.appendChild(C.createTextNode(e)),t},O.getCookie=function(e){for(var t,s,a,i=" "+e+"=",r=C.cookie.split(";"),n=0;n<r.length;n++)if(0<=(s=(t=" "+r[n]).indexOf(i))&&s+i.length==(a=t.indexOf("=")+1))return decodeURIComponent(t.substring(a,t.length).replace(/\+/g,""));return b},O.param=function(e){var t,s=[];for(t in e)e[t]!=b&&s.push(t+"="+encodeURIComponent(e[t]));return s.join("&")},O.cssProperty=function(e,t){var s=(C.body||C.documentElement).style;if(void 0===s)return!1;if("string"==typeof s[e])return!t||e;for(var a=["Moz","Webkit","ms"],e=e.charAt(0).toUpperCase()+e.substr(1),i=0;i<a.length;i++)if("string"==typeof s[a[i]+e])return!t||a[i]+e},!g.DUOSHUO){for(var e in Object.prototype)return alert("Object.prototype 不为空，请不要给 Object.prototype 设置方法");function d(e){return function(){return e}}function l(){for(var e={},t=0;t<arguments.length;t++)arguments[t]&&O.extend(e,arguments[t]);var s=O.param(e);return s?"?"+s:""}function c(){var e=O.getCookie("duoshuo_token");return e?{jwt:e}:E.remote_auth?{short_name:E.short_name,remote_auth:E.remote_auth}:b}function P(){if(!E&&(E=g.duoshuoQuery)){if(!E.short_name||"your_duoshuo_short_name"===E.short_name)return E=b,void alert("你还没有设置多说域名(duoshuoQuery.short_name)，填入已有域名或创建新站点：http://duoshuo.com/create-site/");oe.trigger("queryDefined")}return E}var E,u,p=g.JSON,L=g.location,h=g.XMLHttpRequest,N=p&&p.stringify&&g.localStorage,M=g.navigator.userAgent,f="https:"==C.location.protocol?"https:":"http:",m=0,v=[],I=(a={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=/&(?!\w+;)|[<>"'`]/g,n=/[&<>"'`]/,u=function(e){return null==e||!1===e?"":n.test(e)?e.replace(i,me):e}),R=(G=g.console)&&G.error&&G.warn?G:{error:function(){},log:function(){},warn:function(){}},U=g.DUOSHUO={sourceName:{weibo:"新浪微博",qq:"QQ",qzone:"QQ空间",qqt:"腾讯微博",renren:"人人网",douban:"豆瓣网",kaixin:"开心网",sohu:"搜狐微博",baidu:"百度",google:"谷歌",wechat:"微信",weixin:"微信",facebook:"Facebook",twitter:"Twitter",linkedin:"Linkedin"},serviceNames:{weibo:"微博",qq:"QQ",douban:"豆瓣",renren:"人人",kaixin:"开心",baidu:"百度",google:"谷歌",wechat:"微信",weixin:"微信",facebook:"Facebook",twitter:"Twitter",linkedin:"Linkedin"},parseDate:((t=Date).parse("2011-10-28T00:00:00+08:00")?function(e){return new t(e)}:t.parse("2011/10/28T00:00:00+0800")&&function(e){return new t(e.replace(/-/g,"/").replace(/:(\d\d)$/,"$1"))})||t.parse("2011/10/28 00:00:00+0800")&&function(e){return new t(e.replace(/-/g,"/").replace(/:(\d\d)$/,"$1").replace("T"," "))}||function(e){return new t(e)},fullTime:function(e){e=U.parseDate(e);return e.getFullYear()+"年"+(e.getMonth()+1)+"月"+e.getDate()+"日 "+e.toLocaleTimeString()},elapsedTime:function(e){var t=U.parseDate(e),s=new Date,e=(s-m-t)/1e3;return e<10?"刚刚":e<60?Math.round(e)+"秒前":e<3600?Math.round(e/60)+"分钟前":e<86400?Math.round(e/3600)+"小时前":(s.getFullYear()==t.getFullYear()?"":t.getFullYear()+"年")+(t.getMonth()+1)+"月"+t.getDate()+"日"},compileStyle:function(e){var t,s="",a={textbox:"#ds-thread #ds-reset .ds-replybox .ds-textarea-wrapper"};if(!e)return s;for(t in e)s+=a[t]+"{"+e[t]+"}\n";return s},init:function(e,t){e&&!z[e]&&(z[e]=t||{type:"EmbedThread"}),U.initView&&U.initView()}},A=C.all,W=U.support=function(){var e=C.createElement("div");e.innerHTML='<a href="/a" style="opacity:.55;">a</a><input type="checkbox"/>';var t=e.getElementsByTagName("a")[0],t={placeholder:"placeholder"in e.getElementsByTagName("input")[0],touch:"ontouchstart"in g||"onmsgesturechange"in g,opacity:/^0.55$/.test(t.style.opacity),hrefNormalized:"/a"===t.getAttribute("href"),iOS:M.match(/ \((iPad|iPhone|iPod);( U;)? CPU( iPhone)? OS /),android:M.match(/ \(Linux; U; Android /)};return t.ie6=!h&&void 0===e.style.maxHeight,t.authInWin=g.postMessage&&800<g.screen.width&&!t.iOS&&!t.android&&L.origin,t}(),z=U.selectors={".ds-thread":{type:"EmbedThread"},".ds-recent-comments":{type:"RecentComments"},".ds-recent-visitors":{type:"RecentVisitors"},".ds-top-users":{type:"TopUsers"},".ds-top-threads":{type:"TopThreads"},".ds-login":{type:"LoginWidget"},".ds-thread-count":{type:"ThreadCount"},".ds-share":{type:"ShareWidget"}},B=U.openDialog=function(e){return U.dialog!==b&&U.dialog.el.remove(),U.dialog=new re.Dialog(ie.dialog(e)).open()},D=U.smilies={};U.require=(r={mzadxN:"undefined"!=typeof mzadxN},"undefined"!=typeof jQuery&&"1.5"<=jQuery.fn.jquery&&(r["embed.compat"]=!0,U.jQuery=g.jQuery),function(s,a){if("string"==typeof s)r[s]?a():O.injectScript(fe(s),function(){r[s]=!0,a()});else if("object"==typeof s){for(var e=!0,i=0;i<s.length;i++)!function(t){r[s[i]]||(e=!1,O.injectScript(fe(t),function(){r[t]=!0;for(var e=0;e<s.length;e++)if(!r[s[e]])return;a()}))}(s[i]);e&&a()}});for(var _=0,y=["EmbedThread","RecentComments","RecentVisitors","TopUsers","TopThreads","LoginWidget","ThreadCount"];_<y.length;_++)U[y[_]]=function(s){return function(e,t){(t=t||{}).type=s,e&&!z[e]&&(z[e]=t),U.initSelector&&U.initSelector(e,t)}}(y[_]),U["create"+y[_]]=function(i){return function(e,t){var s,a=C.createElement(e);for(s in t)a.setAttribute("data-"+s,t[s]);return U[i](a),a}}(y[_]);U.RecentCommentsWidget=U.RecentComments;var H=U.API={ajax:function(e,t,s,r,n){function o(e,t,s){var a,i,t=t;if(200<=e&&e<300||304===e)if(304===e)t="notmodified",a=!0;else try{i=p.parse(s),t="success",a=!0}catch(e){t="parsererror",0}else{t&&!e||(t="error",e<0&&(e=0));try{i=p.parse(s)}catch(e){t="parsererror",0}}a?r&&r(i):"parseerror"===t?R.error("解析错误: "+s):(R.error("出错啦("+i.code+"): "+i.errorMessage),n&&n(i),i.errorTrace&&R.error(i.errorTrace)),(i=(i=l).getResponseHeader("Date"))&&(m=new Date-new Date(i))}var a=O.getCookie("duoshuo_token");if((s=s||{}).v=U.version,a?s.jwt=a:E.remote_auth&&(s.remote_auth=E.remote_auth),h&&p&&p.parse){var d,l=new h,a=!!l&&"withCredentials"in l;if(a)return l.open(e,S()+"/api/"+t+".json"+("GET"==e?"?"+O.param(s):""),!0),l.withCredentials=!0,l.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),l.send("GET"==e?null:O.param(s)),d=function(e,t){var s,a,i;try{if(d&&(t||4===l.readyState))if(d=b,t)4!==l.readyState&&l.abort();else{s=l.status,l.getAllResponseHeaders();try{i=l.responseText}catch(e){}try{a=l.statusText}catch(e){a=""}}}catch(e){t||o(-1,e)}i&&o(s,a,i)},void(4===l.readyState?d():l.onreadystatechange=d)}"GET"!=e&&(s._method="POST");e="cb_"+Math.round(1e6*Math.random());H[e]=function(e){0===e.code?r&&r(e):(n&&n(e),R.error("出错啦("+e.code+"): "+e.errorMessage),e.errorTrace&&R.error(e.errorTrace))},s.callback="DUOSHUO.API['"+e+"']",O.injectScript(S()+"/api/"+t+".jsonp?"+O.param(s))},get:function(e,t,s,a){return this.ajax("GET",e,t,s,a)},post:function(e,t,s,a){return this.ajax("POST",e,t,s,a)}},Q=U.ws={messages:[],send:function(e){if(!("WebSocket"in g&&p))return!1;var t,s=this;s.messages.push(p.stringify(e)),s.webSocket||(e="https:"===C.location.protocol?"wss://ws.duoshuo.com:8202/":"ws://ws.duoshuo.com:8201/",(t=s.webSocket=new WebSocket(e)).onopen=function(){var e;if(1===t.readyState)for(;e=s.messages.shift();)t.send(e)},t.onmessage=function(e){try{var t=p.parse(e.data)}catch(e){return}switch(t.type){case"post":for(var s,a=0;a<U.pagelets.length;a++)(s=U.pagelets[a]).threadId==t.thread_id&&s.onMessage(t);break;case"notification":v.push(t),r=g.Notification,"Notification"in g&&"denied"!==r.permission&&("granted"===r.permission&&i(),r.requestPermission(function(e){"granted"===e&&i()}))}function i(){for(var e;e=v.shift();){var t=e.url,s=new r(e.title,{dir:"auto",icon:e.iconUrl,body:e.body});try{s.onclick=function(){g.focus(),L.href=t,s.close()}}catch(e){}setTimeout(function(){s.close&&s.close()},8e3)}}var r},g.addEventListener("beforeunload",function(){t.close()})),s.webSocket.onopen()}};U.DOMAIN="duoshuo.com",U.STATIC_URL=f+"//static.duoshuo.com",U.REMOTE=f+"//duoshuo.com",U.version="16.6.16";var w={default:"9b2a46a0",dark:"33f3a5ac",bluebox:"39a75d50",newhua:"706ba4eb",justflat:"9d72ec5a"},k={"embed.compat":"24f8ca3f",smilies:"921e8eda"},J={post:"发布",posting:"正在发布",settings:"设置",reply:"回复",like:"顶",repost:"转发",report:"举报",delete:"删除",reply_to:"回复 ",reposts:"转发",comments:"评论",floor:"楼",latest:"最新",earliest:"最早",hottest:"最热",share_to:"分享到:",leave_a_message:"说点什么吧…",no_comments_yet:"还没有评论，沙发等你来抢",repost_reason:"请输入转发理由",hot_posts_title:"被顶起来的评论",comments_zero:"暂无评论",comments_one:"1条评论",comments_multiple:"{num}条评论",reposts_zero:"暂无转发",reposts_one:"1条转发",reposts_multiple:"{num}条转发",weibo_reposts_zero:"暂无新浪微博",weibo_reposts_one:"1条新浪微博",weibo_reposts_multiple:"{num}条新浪微博",qqt_reposts_zero:"暂无腾讯微博",qqt_reposts_one:"1条腾讯微博",qqt_reposts_multiple:"{num}条腾讯微博"},V=function(e){return N?N[e]:void 0},x=function(e,t){if(N)try{N.removeItem(e),N[e]=p.stringify(t),N.removeItem(e+":timestamp"),N[e+":timestamp"]=Math.floor((new Date-m)/1e3)}catch(e){}},F=U.loadRequire=function(e){if(e.visitor&&(!le.data&&e.visitor.user_id&&g.Notification&&Q.send({logged_user_id:e.visitor.user_id}),le.reset(e.visitor)),e.site&&(de.reset(e.site),x("ds_site_"+E.short_name,e.site)),!U.theme&&de.data.theme&&s(de.data.theme),e.lang&&(O.extend(J,e.lang),x("ds_lang_"+E.short_name,e.lang)),e.stylesheets)for(var t=0;t<e.stylesheets.length;t++)O.injectStylesheet(e.stylesheets[t]);if(e.nonce&&(U.nonce=e.nonce),e.style&&O.injectStyle((e.style||"")+U.compileStyle(E.component_style)),e.unread&&ce.reset(e.unread),e.warnings)for(t=0;t<e.warnings.length;t++)R.warn(e.warnings[t])},T=0,q=U.Class=function(){};q.extend=function(e){function t(){!T&&this.init&&this.init.apply(this,arguments)}T=1;var s,a=new this;for(s in T=0,e)a[s]=e[s];return((t.prototype=a).constructor=t).extend=arguments.callee,t};var $=U.Event=q.extend({on:function(e,t){var s=this.handlers||(this.handlers={});return s[e]===b&&(s[e]=[]),s[e].push(t),this},trigger:function(e,t){var s=(this.handlers||(this.handlers={}))[e];if(s)for(var a=0;a<s.length&&!1!==s[a].call(this,t);a++);return this}}),X=U.Widget=$.extend({init:function(e,t){this.el=e,this.options=t||{},this.render()},render:function(){},reset:function(){},load:function(e){var t;0===e.code?(F(e),(t=this.prepare(e)).options=O.extend(this.options,e.options),this.onload(t)):this.onError(e)},onload:function(e){this.el.html(ie[this.tmpl](e))},prepare:function(e){return e},onMessage:function(){},onError:function(e){R.error("出错啦("+e.code+"): "+e.errorMessage),e.errorTrace&&R.error(e.errorTrace)}}),G=U.Model=$.extend({init:function(e){this.data=e},reset:function(e){this.data=e,this.trigger("reset")},remove:function(e){this.data.splice(e,1),this.trigger("reset")},set:function(e,t){if(t===b)for(var s in e)this.data[s]=e[s];else this.data[e]=t;return this.trigger("reset"),this},toJSON:function(){return O.extend({},this.data)}}),Y=G.extend({toJSON:function(){return O.extend({},this.data)}}),Z=G.extend({toJSON:function(){var e=O.extend({},this.data);return e.theAuthor=he[this.data.author_id]&&he[this.data.author_id].data||this.data.author,e.parents=this.data.parents||[],e}}),K=G.extend({toJSON:function(){return O.extend({},this.data)}}),q=function(e){this.model=e};q.prototype.set=function(e){for(var t in e)e[t]&&(this[t]?this[t].set(e[t]):this[t]=new this.model(e[t]))},q.prototype.get=function(e){for(var t=0,s=[];t<e.length;t++)s[t]=this[e[t]];return s},q.prototype.getJSON=function(e){for(var t=0,s=[];t<e.length;t++)this[e[t]]&&s.push(this[e[t]].toJSON());return s};function ee(e){var t,s=[];for(t in e)s.push('<input type="hidden" name="'+t+'" value="'+I(e[t])+'" />');return s.join("\n")}var te={userUrl:function(e){return e.url},avatarUrl:function(e){return e.avatar_url||de.data.default_avatar_url},loginUrl:function(e,t){return t=t||{},E.sso&&E.sso.login&&(t.sso=1,t.redirect_uri=E.sso.login),S()+"/login/"+e+"/"+l(t)},bindUrl:function(e){return S()+"/bind/"+e+"/"+l(E.sso&&E.sso.login?{sso:1,redirect_uri:E.sso.login}:null,c())},logoutUrl:function(){return S()+"/logout/"+l(E.sso&&E.sso.logout?{sso:1,redirect_uri:E.sso.logout}:null)}},se=["weixin","weibo","qq","renren"],ae=["douban","kaixin","baidu","google"],ie=U.templates={userAnchor:function(e){return e.url?'<a rel="nofollow author" target="_blank" href="'+I(e.url)+'">'+I(e.name)+"</a>":I(e.name)},avatarImg:function(e,t){return'<img src="'+I(te.avatarUrl(e,t))+'" alt="'+I(e.name)+'"'+(t?' style="width:'+t+"px;height:"+t+'px"':"")+"/>"},avatar:function(e,t){var s=ie.avatarImg(e,t),t=te.userUrl(e);return t?'<a rel="nofollow author" target="_blank" href="'+I(t)+'" '+(e.user_id?" onclick=\"this.href='"+S()+"/user-url/?user_id="+e.user_id+"';\"":"")+' title="'+I(e.name)+'">'+s+"</a>":s},timeText:function(e){return e?'<span class="ds-time" datetime="'+e+'" title="'+U.fullTime(e)+'">'+U.elapsedTime(e)+"</span>":""},timeAnchor:function(e,t){return e?'<a href="'+t+'" target="_blank" rel="nofollow" class="ds-time" datetime="'+e+'" title="'+U.fullTime(e)+'">'+U.elapsedTime(e)+"</a>":""},serviceIcon:function(e,t){return'<a href="javascript:void(0)" class="ds-service-icon'+(t?"-grey":"")+" ds-"+e+'" data-service="'+e+'" title="'+U.sourceName[e]+'"></a>'},poweredBy:function(e){return'<p class="ds-powered-by"><a href="http://duoshuo.com" target="_blank" rel="nofollow">'+I(e)+"</a></p>"},indicator:d('<div id="ds-indicator"></div>'),waitingImg:d('<div id="ds-waiting"></div>'),loginItem:function(e,t){return'<li>    <a href="'+te[t?"bindUrl":"loginUrl"](e)+'" rel="nofollow" class="ds-service-link ds-'+e+'">'+U.serviceNames[e]+(le.data.social_uid[e]?' <span class="ds-icon ds-icon-ok"></span>':"")+"</a></li>"}};ie.commentList=function(e){var t="",s=e.list;if(s)for(var a,i=-1,r=s.length-1;i<r;)a=s[i+=1],t+='<li class="ds-comment',e.options.show_avatars&&(t+=" ds-show-avatars"),t+='" data-post-id="'+a.post_id+'">',e.options.show_avatars&&(t+='<div class="ds-avatar">'+ie.avatar(a.theAuthor,e.options.avatar_size)+"</div>"),t+='<div class="ds-meta">'+ie.userAnchor(a.theAuthor),e.options.show_time&&(t+=ie.timeText(a.created_at)),t+="</div>",t+=e.options.show_title?'<div class="ds-thread-title">在 <a href="'+u(a.thread.url)+'#comments">'+u(a.thread.title)+'</a> 中评论</div><div class="ds-excerpt">'+a.message+"</div>":'<a class="ds-excerpt" title="'+a.thread.title+' 中的评论" href="'+u(a.thread.url)+'#comments">'+a.message+"</a>",t+="</li>";return t},ie.ctxPost=function(e){var t="";return e.post&&(t+='<li class="ds-ctx-entry"',e.hidden&&(t+=' style="display:none"'),t+=' data-post-id="'+e.post.post_id+'"><div class="ds-avatar">'+ie.avatar(e.post.theAuthor||e.post.author)+'</div><div class="ds-ctx-body"><div class="ds-ctx-head">'+ie.userAnchor(e.post.theAuthor||e.post.author)+ie.timeAnchor(e.post.created_at,e.post.url),0<=e.index&&(t+='<div class="ds-ctx-nth" title="'+U.fullTime(e.post.created_at)+'">'+(e.index+1)+J.floor+"</div>"),t+='</div><div class="ds-ctx-content">'+e.post.message,0<=e.index&&(t+='　　　　　　　<div class="ds-comment-actions',0<e.post.vote&&(t+=" ds-post-liked"),t+='">'+ie.likePost(e.post)+'<a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>'+J.repost+'</a><a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>'+J.reply+"</a></div>"),t+="</div></div></li>"),t},ie["dialog-anonymous"]=function(e){var t='<h2>社交帐号登录</h2><div class="ds-icons-32">',s=e.services;if(s)for(var a,i=-1,r=s.length-1;i<r;)t+='<a class="ds-'+(a=s[i+=1])+'" href="'+te.loginUrl(a)+'">'+U.sourceName[a]+"</a>";return t+="</div>",e.options.deny_anonymous||(t+='<h2>作为游客留言</h2><form><div class="ds-control-group"><input type="text" name="author_name" id="ds-dialog-name" value="'+u(le.data.name)+'" required /><label for="ds-dialog-name">名字(必填)</label></div>',e.options.require_guest_email&&(t+='<div class="ds-control-group"><input type="email" name="author_email" id="ds-dialog-email" value="'+u(le.data.email)+'" required /><label for="ds-dialog-email">邮箱(必填)</label></div>'),e.options.require_guest_url&&(t+='<div class="ds-control-group"><input type="url" name="author_url" id="ds-dialog-url" placeholder="http://" value="'+u(le.data.url)+'" /><label for="ds-dialog-url">网址(可选)</label></div>'),t+='<button type="submit">发布</button></form>'),t},ie["dialog-ask-for-auth"]=function(){return'<h2>社交帐号登录</h2><ul class="ds-service-list">'+ie.serviceList(se)+'</ul><ul class="ds-service-list ds-additional-services">'+ie.serviceList(ae)+"</ul>"},ie["dialog-bind-more"]=function(){return'<h2>绑定更多帐号</h2><ul class="ds-service-list">'+ie.serviceBindList(se)+'</ul><ul class="ds-service-list ds-additional-services">'+ie.serviceBindList(ae)+'</ul><div style="clear:both"></div>'},ie["dialog-qrcode"]=function(e){return'<h2>微信扫一扫，分享到朋友圈</h2><div class="ds-share-qrcode" style="text-align:center;"><img src="'+e.qrcode_url+'" alt="'+e.url+'"></div>'},ie["dialog-reposts"]=function(e){var t='<h2>转发到微博</h2><div class="ds-quote"><strong>@'+u(e.post.theAuthor.name)+"</strong>: "+e.post.message+"</div><form>"+ee({post_id:e.post.post_id})+'<div class="ds-textarea-wrapper"><textarea name="message" title="Ctrl+Enter快捷提交" placeholder="'+u(J.repost_reason)+'">'+u(e.repostMessage)+'</textarea><pre class="ds-hidden-text"></pre>';return t+='</div><div class="ds-actions">',e.service?t+=ee({"service[]":e.service}):(t+='<label><input type="checkbox" name="service[]" value="weibo"',le.data.social_uid.weibo&&(t+=' checked="checked"'),t+=' /><span class="ds-service-icon ds-weibo"></span>新浪微博</label><label><input type="checkbox" name="service[]" value="qqt"',le.data.social_uid.qq&&(t+=' checked="checked"'),t+=' /><span class="ds-service-icon ds-qqt"></span>腾讯微博</label>'),t+('<button type="submit">'+J.repost)+"</button></div></form>"},ie.dialog=function(e){return'<div class="ds-dialog"><div class="ds-dialog-inner ds-rounded"><div class="ds-dialog-body">'+e+'</div><div class="ds-dialog-footer"><a href="http://duoshuo.com/" target="_blank" class="ds-logo"></a><span>社会化评论框</span></div><a class="ds-dialog-close" href="javascript:void(0)" title="关闭"></a></div></div>'},ie.hotPosts=function(e){var t='<div class="ds-header ds-gradient-bg">'+u(J.hot_posts_title)+"</div><ul>",s=e.list;if(s)for(var a,i=-1,r=s.length-1;i<r;)a=s[i+=1],t+=ie.post({post:a,options:e.options});return t+"</ul>"},ie.likePost=function(e){var t='<a class="ds-post-likes" href="javascript:void(0);"><span class="ds-icon ds-icon-like"></span>'+J.like;return 0<e.likes&&(t+="("+e.likes+")"),t+"</a>"},ie.likeTooltip=function(e){var t,s='<div class="ds-like-tooltip ds-rounded"><p>很高兴你能喜欢，分享一下吧：</p><ul>';for(t in e.services)s+='<li><a class="ds-share-to-'+t+" ds-service-link ds-"+t+'" href="'+S()+"/share-proxy/?"+O.param({service:t,thread_id:e.thread_id})+'">'+e.services[t]+"</a></li>";return s+'</ul><p class="ds-like-tooltip-footer"><a class="ds-like-tooltip-close">算了</a></p></div>'},ie.loginButtons=function(){return'<div class="ds-login-buttons"><p>社交帐号登录:</p><div class="ds-social-links"><ul class="ds-service-list">'+ie.serviceList(se)+'<li><a class="ds-more-services" href="javascript:void(0)">更多»</a></li></ul><ul class="ds-service-list ds-additional-services">'+ie.serviceList(ae)+"</ul></div></div>"},ie.loginWidget=function(e){var t='<div class="ds-icons-32">',s=e;if(s)for(var a,i=-1,r=s.length-1;i<r;)t+='<a class="ds-'+(a=s[i+=1])+'" href="'+te.loginUrl(a)+'">'+U.sourceName[a]+"</a>";return t+"</div>"},ie.meta=function(e){var t='<div class="ds-meta"><a href="javascript:void(0)" class="ds-like-thread-button ds-rounded';return 0<e.user_vote&&(t+=" ds-thread-liked"),t+='"><span class="ds-icon ds-icon-heart"></span> <span class="ds-thread-like-text">',(t+=0<e.user_vote?"已喜欢":"喜欢")+'</span><span class="ds-thread-cancel-like">取消喜欢</span></a><span class="ds-like-panel"></span></div>'},ie.notify=function(e){var t='<div id="ds-reset"><a class="ds-logo" href="http://duoshuo.com/" target="_blank" title="多说"></a><ul class="ds-notify-unread"><li';return e.comments||(t+=' style="display:none;"'),t+='><a data-type="unread-comments" href="javascript:void(0);">你有'+e.comments+"条新回复</a></li><li",e.notifications||(t+=' style="display:none;"'),t+('><a data-type="unread-notifications" href="javascript:void(0);">你有'+e.notifications)+"条系统消息</a></li></ul></div>"},ie.post=function(e){var t="",s=e.post,a=e.options,i=s.author;if(t+='<li class="ds-post" data-post-id="'+s.post_id+'"><div class="ds-post-self" data-post-id="'+s.post_id+'" data-thread-id="'+s.thread_id+'" data-root-id="'+s.root_id+'" data-source="'+s.source+'"><div class="ds-avatar"',i.user_id&&(t+=' data-user-id="'+i.user_id+'"'),t+=">"+ie.avatar(i),U.sourceName[s.source]&&(t+=ie.serviceIcon(s.source)),t+='</div><div class="ds-comment-body"><div class="ds-comment-header">',i.url?(t+='<a class="ds-user-name ds-highlight" data-qqt-account="'+(i.qqt_account||"")+'" href="'+u(i.url)+'" ',i.user_id&&(t+=" onclick=\"this.href='"+S()+"/user-url/?user_id="+i.user_id+"';\""),t+=' rel="nofollow" target="_blank"',i.user_id&&(t+=' data-user-id="'+i.user_id+'"'),t+=">"+u(i.name)+"</a>"+ua_build_html(e)):(t+='<span class="ds-user-name"',i.user_id&&(t+=' data-user-id="'+i.user_id+'"'),t+=' data-qqt-account="'+(i.qqt_account||"")+'">'+u(i.name)+"</span>"),t+="</div>",1==a.max_depth&&a.show_context&&s.parents.length){t+='<ol id="ds-ctx">';var r=pe.getJSON(s.parents);if(r)for(var n,o=-1,d=r.length-1;o<d;)n=r[o+=1],1==o&&2<s.parents.length&&(t+='<li class="ds-ctx-entry"><a href="javascript:void(0);" class="ds-expand">还有'+(s.parents.length-2)+"条评论</a></li>"),t+=ie.ctxPost({post:n,index:o,hidden:o&&o<s.parents.length-1});t+="</ol>"}if(t+="<p>",s.parents.length>=a.max_depth&&(!a.show_context||1<a.max_depth)&&s.parent_id&&pe[s.parent_id]&&(t+='<a class="ds-comment-context" data-post-id="'+s.post_id+'" data-parent-id="'+s.parent_id+'">'+J.reply_to+u(pe[s.parent_id].toJSON().author.name)+": </a>"),t+=s.message+'</p><div class="ds-comment-footer ds-comment-actions',0<s.vote&&(t+=" ds-post-liked"),t+='">',t+=s.url?ie.timeAnchor(s.created_at,s.url):ie.timeText(s.created_at),"duoshuo"==s.source?(t+='<a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>'+J.reply+"</a>"+ie.likePost(s)+'<a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>'+J.repost+'</a><a class="ds-post-report" href="javascript:void(0);"><span class="ds-icon ds-icon-report"></span>'+J.report+"</a>",s.privileges.delete&&(t+='<a class="ds-post-delete" href="javascript:void(0);"><span class="ds-icon ds-icon-delete"></span>'+J.delete+"</a>")):"qqt"!=s.source&&"weibo"!=s.source||(t+='<a class="ds-weibo-comments" href="javascript:void(0);">'+J.comments,s.type.match(/\-comment$/)||(t+='(<span class="ds-count">'+s.comments+"</span>)"),t+='</a><a class="ds-weibo-reposts" href="javascript:void(0);">'+J.reposts,s.type.match(/\-comment$/)||(t+='(<span class="ds-count">'+s.reposts+"</span>)"),t+="</a>"),t+="</div></div></div>",1<a.max_depth&&(s.childrenArray||s.children)&&"weibo"!=s.source&&"qqt"!=s.source){t+='<ul class="ds-children">';var l=pe.getJSON(s.childrenArray||s.children);if(l)for(var o=-1,c=l.length-1;o<c;)s=l[o+=1],t+=ie.post({post:s,options:a});t+="</ul>"}return t+"</li>"},ie.postListHead=function(e){var t='<div class="ds-comments-info"><div class="ds-sort"><a class="ds-order-desc">'+J.latest+'</a><a class="ds-order-asc">'+J.earliest+'</a><a class="ds-order-hot">'+J.hottest+'</a></div><ul class="ds-comments-tabs"><li class="ds-tab"><a class="ds-comments-tab-duoshuo ds-current" href="javascript:void(0);"></a></li>';return e.options.show_reposts&&e.thread.reposts&&(t+='<li class="ds-tab"><a class="ds-comments-tab-repost" href="javascript:void(0);"></a></li>'),t+=" ",e.options.show_weibo&&e.thread.weibo_reposts&&(t+='<li class="ds-tab"><a class="ds-comments-tab-weibo" href="javascript:void(0);"></a></li>'),t+=" ",e.options.show_qqt&&e.thread.qqt_reposts&&(t+='<li class="ds-tab"><a class="ds-comments-tab-qqt" href="javascript:void(0);"></a></li>'),t+"</ul></div>"},ie.recentVisitors=function(e){var t="",s=e.response;if(s)for(var a,i=-1,r=s.length-1;i<r;)a=s[i+=1],t+='<div class="ds-avatar">'+ie.avatar(a,e.options.avatar_size)+"</div>";return t},ie["related-read"]=function(e){var t="";if(e&&e.length){t+='<article class="ds-reads-expand"><div class="ds-header">头条推荐</div><section> ';var s=e;if(s)for(var a,i=-1,r=s.length-1;i<r;){if(t+=' <a href="'+(a=s[i+=1]).url+'" class="ds-reads-item"> ',3==a.imgs.length){t+=" <h2>"+a.title+'</h2> <div class="ds-reads-pics"> <ul> ';var n=a.imgs;if(n)for(var o=-1,d=n.length-1;o<d;)t+=' <li> <div class="ds-reads-dumb"></div> <div class="ds-reads-pic-wrap" style="background-image:url('+n[o+=1]+');"></div> </li> ';t+=' </ul> </div> <div class="ds-reads-info"> ',1==a.type&&(t+=' <span class="ds-reads-app-special">打开头条阅读</span> '),t+=' <span class="ds-reads-date" data-date="'+a.timeStamp+'"></span> </div> '}else t+=' <div class="ds-reads-desc ',a.imgs.length||(t+="ds-reads-only"),t+='"> <div class="ds-reads-title">'+a.title+'</div> <div class="ds-reads-info"> ',1==a.type&&(t+=' <span class="ds-reads-app-special">打开头条阅读</span> '),t+=' <span class="ds-reads-date" data-date="'+a.timeStamp+'"></span> </div> </div> ',a.imgs.length&&(t+=' <div class="ds-reads-pic-right"> <div class="ds-reads-dumb"></div> <div class="ds-reads-pic-wrap" style="background-image:url('+a.imgs[0]+');"> ',a.hasVideo&&(t+=' <div class="ds-reads-vid-info"><span>'+a.videoDuration+"</span></div> "),t+=" </div> </div> "),t+=" ";t+=" </a> "}t+="</section></article>"}return t},ie.replybox=function(e){var t='<div class="ds-replybox"><a class="ds-avatar"';if(t+=j()?' href="javascript:void(0);" onclick="return false"':' href="'+U.REMOTE+"/settings/avatar/"+l(c())+'" target="_blank" title="设置头像"',t+=">"+ie.avatarImg(le.data)+'</a><form method="post">'+ee(e.params)+'<div class="ds-textarea-wrapper ds-rounded-top"><textarea name="message" title="Ctrl+Enter快捷提交" placeholder="'+u(J.leave_a_message)+'"></textarea><pre class="ds-hidden-text"></pre>',t+="</div>",t+='<div class="ds-post-toolbar"><div class="ds-post-options ds-gradient-bg"><span class="ds-sync">',!j()&&le.data.repostOptions)for(var s in t+='<input id="ds-sync-checkbox',e.inline&&(t+="-inline"),t+='" type="checkbox" name="repost" ',e.checked&&(t+='checked="checked" '),t+='value="'+e.repostArray.join(",")+'"> <label for="ds-sync-checkbox',e.inline&&(t+="-inline"),t+='">'+J.share_to+"</label>",le.data.repostOptions)t+=ie.serviceIcon(s,!le.data.repostOptions[s]);return t+="</span>",t+="</div>",t+='<button class="ds-post-button" type="submit">'+u(J.post)+'</button><div class="ds-toolbar-buttons">',e.options.use_smilies&&(t+='<a class="ds-toolbar-button ds-add-emote" title="插入表情"></a>'),e.options.use_images&&e.options.parse_html_enabled&&(t+='<a class="ds-toolbar-button ds-add-image" title="插入图片"></a>'),(t+="</div></div>")+"</form></div>"},ie.serviceBindList=function(e){var t="",s=e;if(s)for(var a,i=-1,r=s.length-1;i<r;)a=s[i+=1],t+='<li><a href="'+te.bindUrl(a)+'" rel="nofollow" class="ds-service-link ds-'+a+'">'+U.serviceNames[a],le.data.social_uid[a]&&(t+=' <span class="ds-icon ds-icon-ok"></span>'),t+="</a></li>";return t},ie.serviceList=function(e){var t="",s=e;if(s)for(var a,i=-1,r=s.length-1;i<r;)a=s[i+=1],t+='<li><a href="'+te.loginUrl(a)+'" rel="nofollow" class="ds-service-link ds-'+a+'">'+U.serviceNames[a]+"</a></li>";return t},ie.shareWidget=function(e){var t='<div class="ds-share-icons"> <div class="ds-share-icons-inner"> <ul class="ds-share-icons-16"> ',s=e.services;if(s)for(var a,i=-1,r=s.length-1;i<r;)t+=' <li> <a class="ds-'+(a=s[i+=1])+'" href="javascript:void(0);" data-service="'+a+'">'+U.sourceName[a]+"</a> </li> ";return t+(' </ul> </div> <div class="ds-share-icons-footer">'+e.copyright)+"</div></div>"},ie.smiliesTooltip=function(e){var t,s='<div id="ds-smilies-tooltip"><ul class="ds-smilies-tabs">';for(t in e)s+="<li><a>"+t+"</a></li>";return s+'</ul><div class="ds-smilies-container"></div></div>'},ie.toolbar=function(){var e='<div class="ds-toolbar"><div class="ds-account-control"><span class="ds-icon ds-icon-settings"></span> <span>帐号管理</span><ul><li><a class="ds-bind-more" href="javascript:void(0);" style="border-top: none">绑定更多</a></li><li><a target="_blank" href="'+U.REMOTE+"/settings/"+l(c())+'">'+u(J.settings)+'</a></li><li><a rel="nofollow" href="'+te.logoutUrl()+'" style="border-bottom: none">登出</a></li></ul></div><div class="ds-visitor">';return(e+=le.data.url?'<a class="ds-visitor-name" href="'+u(le.data.url)+'" target="_blank">'+u(le.data.name)+"</a>":'<span class="ds-visitor-name">'+u(le.data.name)+"</span>")+'<a class="ds-unread-comments-count" href="javascript:void(0);" title="新回复"></a></div></div>'},ie.topThreads=function(e){var t="",s=e.response;if(s)for(var a,i=-1,r=s.length-1;i<r;)a=s[i+=1],t+='<li><a target="_blank" href="'+u(a.url)+'" title="'+u(a.title)+'">'+u(a.title)+"</a></li>";return t},ie.topUsers=function(e){var t="",s=e.response;if(s)for(var a,i=-1,r=s.length-1;i<r;)a=s[i+=1],t+='<div class="ds-avatar">'+ie.avatar(a,e.options.avatar_size)+"<h4>"+u(a.name)+"</h4></div>";return t},ie.userInfo=function(e){var t,s='<a href="'+u(e.url)+'" onclick="this.href=\''+S()+"/user-url/?user_id="+e.user_id+'\';" class="ds-avatar" target="_blank">'+ie.avatarImg(e)+'</a><a href="'+u(e.url)+'" onclick="this.href=\''+S()+"/user-url/?user_id="+e.user_id+'\';" class="ds-user-name ds-highlight" target="_blank">'+u(e.name)+"</a>";for(t in e.social_uid)s+='<a href="'+U.REMOTE+"/user-proxy/"+t+"/"+e.social_uid[t]+'/" target="_blank" class="ds-service-icon ds-'+t+'" title="'+U.sourceName[t]+'"></a>';return s+='<p class="ds-user-card-meta"><a href="'+U.REMOTE+"/profile/"+e.user_id+'/" target="_blank"><span class="ds-highlight">'+e.comments+"</span>条评论</a></p>",e.description&&(s+='<p class="ds-user-description">'+u(e.description)+"</p>"),s};var re=U.Views={},ne=(U.Callbacks={},U.pagelets=[]),oe=U.events=new $,de=U.site=new G,le=U.visitor=new Y,ce=U.unread=new G,ue=U.threadPool=new q(K),pe=U.postPool=new q(Z),he=U.userPool=new q(Y);oe.on("queryDefined",function(){var e,t=E.short_name;E.theme&&s(E.theme),N&&(e=N["ds_site_"+t],t=N["ds_lang_"+t],e&&de.reset(p.parse(e)),t&&O.extend(J,p.parse(t)))}),P(),U.require("embed.compat",function(){function d(e){e.stopPropagation()}function _(e){(e.ctrlKey&&13==e.which||10==e.which)&&q(this.form).trigger("submit")}function y(){var e=q(this);e.height(Math.max(54,e.next(".ds-hidden-text").text(this.value).height()+27))}function w(){if(W.authInWin){var e=this.href.match(/\/(login|bind)\/(\w+)\//i);if(e&&U.serviceNames[e[2]])return!s(e[2],this.href)}}function k(){var e,t,s,a,i=this,r=0,n=0;!C.selection||(a=C.selection.createRange())&&a.parentElement()==i&&(s=i.value.length,e=i.value.replace(/\r\n/g,"\n"),(t=i.createTextRange()).moveToBookmark(a.getBookmark()),(a=i.createTextRange()).collapse(!1),-1<t.compareEndPoints("StartToEnd",a)?r=n=s:(r=-t.moveStart("character",-s),r+=e.slice(0,r).split("\n").length-1,-1<t.compareEndPoints("EndToEnd",a)?n=s:(n=-t.moveEnd("character",-s),n+=e.slice(0,n).split("\n").length-1))),q(i).data("ds-range-start",r).data("ds-range-end",n)}function n(e){return W.touch&&e.addClass("ds-touch"),O.cssProperty("transition")||e.addClass("ds-no-transition"),W.ie6&&e.addClass("ds-ie6"),W.opacity||e.addClass("ds-no-opacity"),e}function x(e){var t;return W.placeholder||(t=e.attr("placeholder"),e.val(t).focus(function(){this.value===t&&(this.value="")}).blur(function(){""===this.value&&(this.value=t)})),e}function e(e){"http://duoshuo.com"===e.origin&&"login"===e.data.type&&(L.href=e.data.redirectUrl)}function s(e,t){e={weibo:[760,600],renren:[420,322],qq:[504,445],weixin:[450,550],google:[600,440]}[e]||[550,400];return g.open(t+(-1==t.indexOf("?")?"?":"&")+O.param({origin:L.origin||"http://"+L.host}),"_blank","width="+e[0]+",height="+e[1]+",toolbar=no,menubar=no,location=yes")}function o(e){var t=te[j()?"loginUrl":"bindUrl"](e);W.authInWin&&s(e,t)||(L.href=t)}function r(e,t,s,a){var i=B(ie["dialog-reposts"]({post:e.toJSON(),repostMessage:t,service:a})),r=i.el.find("form");return r.submit(function(){return a||r.find("[type=checkbox]:checked")[0]?(H.post("posts/repost",U.toJSON(r),function(e){var t;s&&a&&(t=s.options,e=T(s.postList.el,e.response[a],t),"asc"==t.order==("top"==t.formPosition)&&U.scrollTo(e),(e=s.el.find(".ds-comments-tab-"+a+" span.ds-highlight")).html(parseInt(e.html())+1))}),i.close()):alert("还没有选发布到哪儿呢"),!1}),r.find(".ds-actions [type=checkbox]").change(function(){var e=this.value;return this.checked&&!le.data.social_uid["qqt"==e?"qq":e]?void o(e):void 0}),x(r.find("textarea")).keyup(_).keyup(y).focus(),0}function l(e){var t={"unread-comments":{title:"新留言及回复",apiUrl:"users/unreadComments",tmpl:function(e){return e.thread?'<li data-thread-id="'+e.thread.thread_id+'">'+q.map(e.authors,ie.userAnchor).join("、")+' 在 <a class="ds-read" href="'+e.thread.url+'#comments" target="_blank">'+I(e.thread.title||"无标题")+'</a> 中回复了你 <a class="ds-delete ds-read" title="知道了" href="javascript:void(0)">知道了</a></li>':""},read:function(e){e=e.attr("data-thread-id");H.post("threads/read",{thread_id:e}),ce.data.comments--}},"unread-notifications":{title:"系统消息",apiUrl:"users/unreadNotifications",tmpl:function(e){return'<li data-notification-id="'+e.notification_id+'" data-notification-type="'+e.type+'">'+e.content+' <a class="ds-delete ds-read" title="知道了" href="javascript:void(0)">知道了</a></li>'},read:function(e){e=e.attr("data-notification-id");H.post("notifications/read",{notification_id:e}),ce.data.notifications--}}}[e],s=B("<h2>"+t.title+'</h2><ul class="ds-unread-list"></ul>');s.on("close",U.resetNotify);var a=s.el.find(".ds-unread-list").delegate(".ds-delete","click",function(){return q(this).parent().remove(),0===a.children().length&&s.close(),!1}).delegate(".ds-read","click",function(){t.read(q(this).parent())});q("#ds-notify").hide(),H.get(t.apiUrl,{},function(e){s.el.find(".ds-unread-list").html(q.map(e.response,t.tmpl).join("\n"))})}function c(){bubbleOutTimer&&(clearTimeout(bubbleOutTimer),bubbleOutTimer=0)}function t(){bubbleOutTimer=setTimeout(function(){bubbleOutTimer=0,h.detach()},400)}function T(e,t,s){return e.find(".ds-post[data-post-id="+t.data.post_id+"]")[0]?void 0:(e.find(".ds-post-placeholder").remove(),q(ie.post({post:t.toJSON(),options:s})).hide()["asc"==s.order?"appendTo":"prependTo"](e).slideDown(function(){}))}function a(d,a){var i;this.delegate("a.ds-post-likes","click",function(){if(j())return B(ie["dialog-ask-for-auth"]({})).el.find(".ds-dialog").css("width","300px").find("a.ds-service-link").click(w),!1;var e=q(this).parent(),t=e.hasClass("ds-post-liked"),s=((s=q(this).html().match(/\((\d+)\)/))?parseInt(s[1]):0)+(t?-1:1);return H.post("posts/vote",{post_id:e.closest(".ds-ctx-entry, .ds-post-self").attr("data-post-id"),vote:t?0:1}),q(this).html(q(this).html().replace(/\(\d+\)/,"")+(s?"("+s+")":"")),e[t?"removeClass":"addClass"]("ds-post-liked"),!1}).delegate("a.ds-post-repost","click",function(){var e=q(this).closest(".ds-post-self");return r(pe[e.attr("data-post-id")],""),!1}).delegate("a.ds-post-delete","click",function(){if(!confirm("确定要删除这条评论吗？"))return!1;var e=q(this).closest(".ds-post-self");return H.post("posts/remove",{post_id:e.attr("data-post-id")}),e.parent().fadeOut(200,function(){d.data.comments--,d.updateCounter("duoshuo"),q(this).remove()}),!1}).delegate("a.ds-post-report","click",function(){if(!confirm("确定要举报这条评论吗？"))return!1;var e=q(this).closest(".ds-post-self");return H.post("posts/report",{post_id:e.attr("data-post-id")}),alert("感谢您的反馈！"),!1}).delegate("a.ds-post-reply","click",function(){var e,t=q(this),s=t.closest(".ds-comment-actions");return s.hasClass("ds-reply-active")?(i.el.fadeOut(200,function(){q(this).detach()}),s.removeClass("ds-reply-active")):(e=t.closest(".ds-ctx-entry, .ds-post-self"),i?i.actionsBar.removeClass("ds-reply-active"):(i=new re.Replybox(d)).render(!0).el.addClass("ds-inline-replybox").detach(),i.el.find("[name=parent_id]").val(e.attr("data-post-id")),i.el.show().appendTo(t.closest(".ds-ctx-body, .ds-comment-body")).find("textarea").focus(),i.actionsBar=s.addClass("ds-reply-active"),a.max_depth<=1?i.postList=d.postList.el:(i.postList=e.siblings(".ds-children"),i.postList[0]||(i.postList=q('<ul class="ds-children"></ul>').insertAfter(e)))),!1}).delegate("a.ds-weibo-comments","click",function(){var e=q(this).closest(".ds-post-self"),t=e.attr("data-post-id");if(e.data("source"),0!=e.attr("data-root-id"))return!1;var s=e.siblings(".ds-children");return s[0]?s.remove():(s=q('<ul class="ds-children"></ul>').insertAfter(e),H.get("posts/listComments",u({post_id:t}),function(e){F(e),s.append(q.map(e.response,function(e){return ie.post({post:e,options:a})}).join(""))})),!1}).delegate("a.ds-weibo-reposts","click",function(){var e=q(this).closest(".ds-post-self"),t=pe[e.attr("data-post-id")],s=t.data.source;if(le.data.social_uid["qqt"==s?"qq":s]){var a=t.data.root_id,i="0"!=a?pe[a]:t,e="";return"0"!=a&&(a=prepatePost(t.data).theAuthor,e=("weibo"==s?"//@"+a.name:"|| @"+a.qqt_account)+":"+t.data.message),r(i,e,d,s),!1}o(s)}).delegate("a.ds-expand","click",function(){var e=q(this).parent();return e.siblings().show(),e.remove(),!1}),W.touch||this.delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseenter",function(){var n=this;if(bubbleOutTimer&&h.owner==n)return clearTimeout(bubbleOutTimer),void(bubbleOutTimer=0);var o=q(n);m=setTimeout(function(){m=0,h.owner=n,c();var e=o.offset(),t=d.el.offset(),s=o.innerWidth()/2,a=d.el.innerHeight()-(e.top-t.top)+6,s=e.left-t.left-35+(35<s?35:s);try{if(o.hasClass("ds-comment-context"))f.attr("id","ds-ctx-bubble").attr("data-post-id",o.attr("data-post-id")).html('<ul id="ds-ctx">'+ie.ctxPost({post:pe[o.attr("data-parent-id")].toJSON()})+'</ul><div class="ds-bubble-footer"><a class="ds-ctx-open" href="javascript:void(0);">查看对话</a></div>');else if(o.hasClass("ds-avatar")||o.hasClass("ds-user-name")){var i={},r=i.user_id=o.attr("data-user-id");if(!r)throw"no info";f.attr("id","ds-user-card").attr("data-user-id",r).empty(),he[r]?f.html(ie.userInfo(he[r].data)):H.get("users/profile",u(i),function(e){e=e.response,he[r]?he[r].set(e):he[r]=new Y(e),h.owner==n&&f.html(ie.userInfo(e))})}h.css({bottom:a,left:s}).appendTo(d.innerEl)}catch(e){h.detach()}},200)}).delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseleave",function(){m?(clearTimeout(m),m=0):bubbleOutTimer||t()})}function u(e){var t,s={require:"site,visitor,nonce,lang"+(v++?"":",unread,log,extraCss"),site_ims:V("ds_site_"+E.short_name+":timestamp"),lang_ims:V("ds_lang_"+E.short_name+":timestamp"),referer:C.referrer};for(t in E.stylePatch&&(s.style_patch=E.stylePatch),s)s[t]&&(!W.ie6||encodeURIComponent(s[t]).length<200)&&(e[t]=s[t]);return e}var q=U.jQuery,i=q(g),p=q(C);g.postMessage&&(g.addEventListener?g.addEventListener("message",e,!1):g.attachEvent&&g.attachEvent("onmessage",e)),U.scrollTo=function(e){e=e.offset().top;(e<i.scrollTop()||e>i.scrollTop()+i.height())&&q("html, body").animate({scrollTop:e-40},200,"swing")},U.toJSON=function(e){var a=/\r?\n/g,t=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,s=/^(?:select|textarea)/i,e=e.map(function(){return this.elements?q.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||s.test(this.nodeName)||t.test(this.type))}).map(function(e,t){var s=q(this).val();return null==s?null:q.isArray(s)?q.map(s,function(e){return{name:t.name,value:e.replace(a,"\r\n")}}):{name:t.name,value:s.replace(a,"\r\n")}}).toArray(),i={};return q.each(e,function(){i[this.name]=this.value}),i},U.resetNotify=function(){var e=q("#ds-notify"),t=ce.data;(e=!e[0]?q('<div id="ds-notify"></div>').css({hidden:{display:"none"},"top-right":{top:"24px",right:"24px"},"bottom-right":{bottom:"24px",right:"24px"}}[de.data.notify_position]).delegate(".ds-notify-unread a","click",function(){return l(q(this).data("type")),!1}).appendTo(C.body):e).html(ie.notify(t))[!t.comments&&!t.notifications||"hidden"===de.data.notify_position||q(".ds-dialog")[0]?"hide":"show"]()},ce.on("reset",U.resetNotify),re.Replybox=function(e){this.embedThread=e},re.Replybox.prototype={render:function(e){function s(e){e.data("submitting",!1),e.find(".ds-post-button").removeClass("ds-waiting").html(J.post)[0].disabled=!1}function t(){U.require("smilies",function(){})}var a,i=this,r=i.embedThread,n=r.options,o={thread:r,options:n,inline:e,params:{thread_id:r.threadId,parent_id:"",nonce:U.nonce},repostArray:[],checked:0};for(a in le.data.repostOptions)le.data.repostOptions[a]&&(o.repostArray.push(a),o.checked=1);function d(e,t){var s,a=B(ie["dialog-anonymous"]({services:["weixin","weibo","qq","renren","kaixin","douban"],options:n}));a.el.find(".ds-dialog").css("width","320px").find(".ds-icons-32 a").click(w),n.deny_anonymous||((s=a.el.find("form")).submit(function(){var e=s.find("input[name=author_email]").val();return!e&&!n.require_guest_email||e.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)?(t(U.toJSON(s)),a.close()):alert("请输入一个有效的email地址."),!1}),s.find("input[name=author_name]")[0].focus())}var l=i.el=q(ie.replybox(o)).click(t),c=l.find("form"),u=c.find("input[type=checkbox]")[0],p=c.find("a.ds-service-icon, a.ds-service-icon-grey"),h=x(c.find("textarea")).focus(t).keyup(_).keyup(y).bind("focus mousedown mouseup keyup",k),f=l.find(".ds-add-emote").click(function(e){var t=U.smiliesTooltip;return f.toggleClass("ds-expanded").hasClass("ds-expanded")?(t||((t=U.smiliesTooltip=new re.SmiliesTooltip).render(),U.require("smilies",function(){t.reset("微博-默认")})),t.replybox=i,t.el.appendTo(C.body).css({top:i.el.offset().top+i.el.outerHeight()+4+"px",left:i.el.find(".ds-textarea-wrapper").offset().left+"px"}),q(C.body).click(m)):m(e),!1}),m=(l.find(".ds-add-image").click(function(e){var t,s=h[0],a=s.value,i="请输入图片地址",r='<img src="'+i+'" />';C.selection?(s.value=a.substring(0,h.data("ds-range-start"))+r+a.substring(h.data("ds-range-end"),a.length),s.value=s.value.replace("说点什么吧 ...",""),s.focus(),(t=C.selection.createRange()).collapse(),t.findText(i),t.select()):(s.value=a.substring(0,s.selectionStart)+r+a.substring(s.selectionEnd),a=s.value.search(i),s.setSelectionRange(a,a+i.length),s.focus()),e.preventDefault()}),i.hideSmilies=function(){f.removeClass("ds-expanded"),U.smiliesTooltip.el.detach(),q(C.body).unbind("click",m)});n.deny_anonymous&&h.focus(function(){var t;return j()&&(d(0,v),t=function(e){e.stopPropagation(),h.unbind("click",t)},h.click(t)),!1});var v=function(e){var t;(t=c).data("submitting",!0),t.find(".ds-post-button").addClass("ds-waiting").html(J.posting)[0].disabled=!0,H.post("posts/create",q.extend(U.toJSON(c),e),function(e){e=pe[e.response.post_id]=new Z(e.response),e=T(i.postList,e,n);if("asc"==n.order==("top"==n.formPosition)&&U.scrollTo(e),r.data.comments++,r.updateCounter("duoshuo"),h.val("").trigger("keyup"),s(c),l.hasClass("ds-inline-replybox")&&(l.detach(),i.actionsBar.removeClass("ds-reply-active")),N)try{N.removeItem("ds_draft_"+r.threadId)}catch(e){}},function(e){s(c),alert(e.errorMessage)})};c.submit(function(){if(c.data("submitting"))return!1;var e=q.trim(c[0].message.value);return""==e||!W.placeholder&&e==h.attr("placeholder")?alert("您还没写内容呢"):j()?d(0,v):v(),!1});function g(e){return q(e).hasClass("ds-service-icon-grey")?null:q(e).attr("data-service")}var b;return p.click(function(){return q(this).toggleClass("ds-service-icon-grey").toggleClass("ds-service-icon"),u.value=q.map(p,g).join(","),u.checked=""!=u.value,!1}),q(u).change(function(){var e=this.checked;p[e?"removeClass":"addClass"]("ds-service-icon-grey")[e?"addClass":"removeClass"]("ds-service-icon"),this.value=q.map(p,g).join(",")}),!e&&N&&(b="ds_draft_"+r.threadId,h.bind("focus blur keyup",function(e){var t=q(e.currentTarget).val();try{N[b]=t}catch(e){}}),N[b]&&h.val(N[b])),this}},re.Dialog=$.extend({init:function(e,t){(this.el=q("#ds-wrapper"))[0]||(this.el=n(q('<div id="ds-wrapper"></div>'))),this.options=q.extend({width:600},t),e!==b&&q(e).attr("id","ds-reset").appendTo(this.el)},open:function(){function e(e){return 27==e.which?(s.close(),!1):void 0}function t(){return s.close(),!1}var s=this;return s.el.hide().appendTo(C.body).fadeIn(200),W.ie6&&s.el.css("top",i.scrollTop()+100),s.el.show().find(".ds-dialog").delegate("a.ds-dialog-close","click",function(){return s.close(),!1}).click(d),p.keydown(e),q(C.body).click(t),s.close=function(){p.unbind("keydown",e),q(C.body).unbind("click",t),s.el.fadeOut(200,function(){q(this).remove()}),s.trigger("close")},s}}),ie.likePanel=function(e){return e.likes?'<span class="ds-highlight">'+e.likes+"</span> 人喜欢":""},re.Meta=function(e){this.embedThread=e},re.Meta.prototype={render:function(){var i=this,r=i.embedThread.model,n=i.el=q(ie.meta(r.toJSON())),o=n.find(".ds-like-thread-button");return o.click(function(e){function t(){i.tooltip.detach(),q(C.body).unbind("click",t)}var s=o.hasClass("ds-thread-liked");if(H.post("threads/vote",{thread_id:i.embedThread.threadId,vote:s?0:1},function(e){r.set(e),i.resetLikePanel()}),o.toggleClass("ds-thread-liked"),o.find(".ds-thread-like-text").text(s?"喜欢":"已喜欢"),s)return i.tooltip&&t(),!1;i.tooltip===b&&(a=ie.likeTooltip({services:{qzone:"QQ空间",weibo:"新浪微博",qqt:"腾讯微博",renren:"人人网",kaixin:"开心网",douban:"豆瓣网",baidu:"百度搜藏"},thread_id:r.data.thread_id}),i.tooltip=q(a).click(d).delegate("a","click",function(e){if("ds-like-tooltip-close"===this.className)t();else if(!g.open(this.href,"_blank","height=500,width=600,top=0,left=0,toolbar=no,menubar=no,resizable=yes,location=yes,status=no"))return;return!1}));var a={left:0};return a.top=n.position().top+n.outerHeight()-4+"px",i.tooltip.appendTo(i.embedThread.innerEl).css(a),q(C.body).click(t),!1}),i.resetLikePanel(),j()&&n.hide(),i},resetLikePanel:function(){this.el.find(".ds-like-panel").html(ie.likePanel(this.embedThread.model.toJSON()))}},re.PostListHead=function(e){this.embedThread=e},re.PostListHead.prototype={render:function(){var t=this.embedThread,s=t.postList,e=this.el=q(ie.postListHead({thread:t.model.toJSON(),options:t.options})),a=e.find("ul.ds-comments-tabs");a.delegate(".ds-tab a","click",function(e){switch(a.find("a.ds-current").removeClass("ds-current"),s.params.page=1,(e=e.currentTarget).className){case"ds-comments-tab-duoshuo":s.params.source="duoshuo",t.replybox.el.show();break;case"ds-comments-tab-repost":s.params.source="repost",t.replybox.el.hide();break;case"ds-comments-tab-weibo":s.params.source="weibo",t.replybox.el.hide();break;case"ds-comments-tab-qqt":s.params.source="qqt",t.replybox.el.hide()}return q(e).addClass("ds-current"),s.refetch(),!1});var i=e.find(".ds-sort");return i.delegate("a","click",function(){return i.find("a.ds-current").removeClass("ds-current"),s.params.order=t.options.order=this.className.replace("ds-order-",""),s.params.page=1,s.refetch(),q(this).addClass("ds-current"),!1}),i.find(".ds-order-"+s.params.order).addClass("ds-current"),this}},re.Paginator=function(e){var t=this.el=(e=e||{}).el||q('<div class="ds-paginator"></div>'),s=this.collection=e.collection;t.delegate("a","click",function(){return s.params.page=parseInt(this.innerHTML),s.refetch(),t.find(".ds-current").removeClass("ds-current"),q(this).addClass("ds-current"),!1})},re.Paginator.prototype={reset:function(e){function t(e){i.push('<a data-page="'+e+'" href="javascript:void(0);">'+e+"</a>")}var s,a=this.collection.params.page||1,i=[];if(1<a)for(t(1),2<(s=4<a?a-2:2)&&i.push('<span class="page-break">...</span>');s<a;s++)t(s);if(i.push('<a data-page="'+a+'" href="javascript:void(0);" class="ds-current">'+a+"</a>"),a<e.pages){for(s=a+1;s<=a+4&&s<e.pages;s++)t(s);s<e.pages&&i.push('<span class="page-break">...</span>'),t(e.pages)}this.el.html('<div class="ds-border"></div>'+i.join(" "))[1<e.pages?"show":"hide"]()}},U.addSmilies=function(e,t){var s=U.smiliesTooltip;s&&s.el.find("ul.ds-smilies-tabs").append("<li><a>"+e+"</a></li>"),U.smilies[e]=t},re.SmiliesTooltip=function(){},re.SmiliesTooltip.prototype={render:function(){var r=this,e=r.el=q(ie.smiliesTooltip(D));return e.click(d).find("ul.ds-smilies-tabs").delegate("a","click",function(){r.reset(this.innerHTML)}),e.find(".ds-smilies-container").delegate("img","click",function(){var e,t=r.replybox,s=t.el.find("textarea"),a=s[0],i=a.value;C.selection?(a.value=i.substring(0,s.data("ds-range-start"))+this.title+i.substring(s.data("ds-range-end"),i.length),a.value=a.value.replace(J.leave_a_message,""),a.focus(),(e=C.selection.createRange()).moveStart("character",s.data("ds-range-start")+this.title.length),e.collapse(),e.select()):(e=a.selectionStart+this.title.length,a.value=i.substring(0,a.selectionStart)+this.title+i.substring(a.selectionEnd),a.setSelectionRange(e,e)),t.hideSmilies(),a.focus()}),this},reset:function(s){var e=this.el.find("ul.ds-smilies-tabs");e.find("a.ds-current").removeClass("ds-current"),e.find("a").filter(function(){return this.innerHTML==s}).addClass("ds-current");var a="<ul>";return q.each(D[s],function(e,t){t=0===s.indexOf("微博")?"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/"+t.replace("_org","_thumb"):U.STATIC_URL+"/images/smilies/"+t,a+='<li><img src="'+t+'" title="'+I(e="WordPress"===s?" "+e+" ":e)+'" /></li>'}),a+="</ul>",this.el.find(".ds-smilies-container").html(a),this}},ie.postPlaceholder=function(){return['<li class="ds-post ds-post-placeholder">',J.no_comments_yet,"</li>"].join("")};var h=q('<div id="ds-bubble"><div class="ds-bubble-content"></div><div class="ds-arrow ds-arrow-down ds-arrow-border"></div><div class="ds-arrow ds-arrow-down"></div></div>'),f=h.find(".ds-bubble-content").delegate("a.ds-ctx-open","click",function(){var e={};e.post_id=f.attr("data-post-id"),H.get("posts/conversation",e,function(e){function t(e,t){return ie.ctxPost({post:e,index:t})}R.log(q.map(e.response,t).join("\n")),s.el.find("ol"),s.el.find("ol").html(q.map(e.response,t).join("\n"))});var s=B('<h2>查看对话</h2><ol id="ds-ctx"></ol>');return s.el.find(".ds-dialog").css("width","600px"),s.el.find(".ds-dialog-body").css({"max-height":"350px",_height:"350px","overflow-y":"auto","padding-top":"10px"}),!1}),m=bubbleOutTimer=0;h.mouseenter(c).mouseleave(t),re.PostList=function(e){e&&(e.params&&(this.params=e.params),e.embedThread&&(this.embedThread=e.embedThread)),this.el=q('<ul class="ds-comments"></ul>')},re.PostList.prototype={url:"threads/listPosts",render:function(){return a.call(this.el,this.embedThread,this.embedThread.options),this},reset:function(e){var t=this.embedThread.options;this.el.html(e[0]?q.map(pe.getJSON(e),function(e){return ie.post({post:e,options:t})}).join(""):ie.postPlaceholder())},refetch:function(){var t=this,s=q(ie.indicator()).appendTo(C.body).fadeIn(200);t.el.fadeTo(200,.5),H.get(t.url,t.params,function(e){pe.set(e.parentPosts||e.relatedPosts),he.set(e.users),t.reset(e.response),t.embedThread.paginator.reset(e.cursor),t.el.fadeTo(200,1),U.scrollTo(t.el),s.remove()})}},re.RelatedRead=function(){this._init()},re.RelatedRead.prototype={_init:function(){this.el=q('<div id="ds-related-reads"></div>')},load:function(e){g.__duoshuo_id__=e,g.readsByToutiao=[],g.readsByToutiao.push({id:"ds-related-reads",num:3});e=C.createElement("script");e.src="//s0.pstatp.com/site/reads-sdk/5bf3702b38076207bee1.js",e.charset="utf-8",e.crossOrigin="anonymous",C.head.appendChild(e)},mount:function(e){this.el.insertBefore(e)}},re.EmbedThread=X.extend({uri:"threads/listPosts",params:"thread-id local-thread-id source-thread-id thread-key category channel-key author-key author-id url limit order max-depth form-position container-url"+(M.match(/MSIE 6\.0/)?"":" title image thumbnail"),render:function(){var e=this.el;if("请将此处替换成文章在你的站点中的ID"===e.data("thread-key"))return alert("请设置正确的 data-thread-key 属性"),!1;e.attr("id","ds-thread").append(ie.waitingImg());var t=e.width(),s=e.data("url")||!e.attr("data-thread-id")&&q("link[rel=canonical]").attr("href");s?e.data("url",function(e){if(e.match(/^(http|https):/))return e;var t=C.createElement("a");return t.href=e,W.hrefNormalized?t.href:t.getAttribute("href",4)}(s)):e.data("container-url",L.href),t&&t<=400&&e.addClass("ds-narrow").data("max-depth",1)},updateCounter:function(e){function t(e){return e.substr(e.indexOf("}")+1)}var s,a,i={duoshuo:["comments",t(J.comments_multiple)||"评论"],repost:["reposts",t(J.reposts_multiple)||"转载"],weibo:["weibo_reposts",t(J.weibo_reposts_multiple)||"新浪微博"],qqt:["qqt_reposts",t(J.qqt_reposts_multiple)||"腾讯微博"]};for(s in i)e&&e!=s||(a=this.data[i[s][0]],this.el.find(".ds-comments-tab-"+s).html(this.el.hasClass("ds-narrow")?'<span class="ds-service-icon ds-'+s+'"></span>'+a:(a?'<span class="ds-highlight">'+a+"</span>":"0")+i[s][1]))},onError:function(e){this.el.html("评论框出错啦("+e.code+"): "+e.errorMessage)},onload:function(e){var s=this,t=s.threadId=e.thread.thread_id,a=e.cursor,i=s.options=e.options,r=s.innerEl=n(q('<div id="ds-reset"></div>').appendTo(s.el));s.model=new K(s.data=e.thread),pe.set(e.parentPosts||e.relatedPosts),he.set(e.users),s.el.find("#ds-waiting").remove(),e.options&&e.options.show_recommend&&(s.relatedRead=new re.RelatedRead,s.relatedRead.load(e.thread.site_id),s.relatedRead.mount(r)),i.like_thread_enabled&&(s.meta=new re.Meta(s),r.append(s.meta.render().el)),i.hot_posts&&e.hotPosts&&e.hotPosts.length&&(s.hotPosts=new re.HotPosts(q('<div class="ds-rounded"></div>'),{max_depth:1,show_context:i.show_context}),s.hotPosts.thread=s,r.append(s.hotPosts.el),s.hotPosts.onload({list:pe.getJSON(e.hotPosts)})),s.postListHead=new re.PostListHead(s),s.postList=new re.PostList({embedThread:s,params:{source:"duoshuo",thread_id:t,max_depth:i.max_depth,order:i.order,limit:i.limit}}),s.postList.render().reset(e.response),s.paginator=new re.Paginator({collection:s.postList}),s.paginator.reset(a);t=s.replybox=new re.Replybox(s);t.postList=s.postList.el,j()?s.loginButtons=q(ie.loginButtons()).delegate("a.ds-more-services","click",function(){return s.loginButtons.find(".ds-additional-services").toggle(),!1}).delegate("a.ds-service-link","click",w):s.toolbar=q(ie.toolbar()).delegate(".ds-account-control","mouseenter",function(){q(this).addClass("ds-active")}).delegate(".ds-account-control","mouseleave",function(){q(this).removeClass("ds-active")}).delegate("a.ds-bind-more","click",function(){return B(ie["dialog-bind-more"]()).el.find(".ds-dialog").addClass("ds-dialog-bind-more").css("width","300px").find("a.ds-service-link").click(w),!1}).delegate("a.ds-unread-comments-count","click",function(){return l("unread-comments"),!1});a=['<a name="respond"></a>',s.toolbar||s.loginButtons,t.render().el];"top"==i.formPosition&&q.fn.append.apply(r,a),r.append(s.postListHead.render().el,s.postList.el,s.paginator.el),"bottom"==i.formPosition&&q.fn.append.apply(r,a),r.append(ie.poweredBy(i.poweredby_text)),s.updateCounter(),e.alerts&&q.each(e.alerts,function(e,t){q('<div class="ds-alert">'+t+"</div>").insertBefore(s.toolbar||loginButtons)}),i.message&&t.el.find("textarea").val(i.message).focus(),ce.on("reset",function(){var e=ce.data.comments||0;r.find("a.ds-unread-comments-count").html(e).attr("title",e?"你有"+e+"条新回复":"你没有新回复").css("display",e?"inline":"none")}),i.mzadx_id&&(U.require("mzadxN",function(){}),q('<div id="MZADX_'+i.mzadx_id+'" style="margin:0 auto;"></div>').appendTo(r),__mz_rpq=g.__mz_rpq||[],__mz_rpq.push({l:[i.mzadx_id],r:"1",_srv:"MZADX",_callback:function(){}})),U.thread=s,ce.data!==b&&ce.trigger("reset"),j()||Q.send({visit_thread_id:s.threadId})},onMessage:function(e){T(this.postList.el,new Z(e),this.options)}}),re.HotPosts=X.extend({tmpl:"hotPosts",params:"show-quote",render:function(){return this.el.attr("id","ds-hot-posts"),this},onload:function(e){e.options=q.extend(this.options,e.options),X.prototype.onload.call(this,e),a.call(this.el.find("ul"),this.thread,this.options)}}),re.RecentComments=X.extend({tmpl:"commentList",uri:"sites/listRecentPosts",params:"show-avatars show-time show-title avatar-size show-admin excerpt-length num-items channel-key",render:function(){this.el.attr("id","ds-recent-comments")},prepare:function(e){return{list:q.map(e.response,function(e){return new Z(e).toJSON()})}}}),re.RecentVisitors=X.extend({tmpl:"recentVisitors",uri:"sites/listVisitors",params:"show-time avatar-size num-items channel-key",render:function(){this.el.children().detach(),this.el.attr("id","ds-recent-visitors").append(this.waitingEl=q(ie.waitingImg()))}}),re.TopThreads=X.extend({tmpl:"topThreads",uri:"sites/listTopThreads",params:"range num-items channel-key",render:function(){this.el.children().detach(),this.el.attr("id","ds-top-threads").append(this.waitingEl=q(ie.waitingImg()))}}),re.LoginWidget=X.extend({tmpl:"loginWidget",render:function(){var e=this.el;e.attr("id","ds-login").html(ie.loginWidget(["weixin","weibo","qq","renren","kaixin","douban"])),e.find("a").click(w),e.find("a.ds-logout").attr("href",te.logoutUrl())}}),re.ThreadCount=X.extend({onload:function(e){var t=this.el,s=t.data("count-type")||"comments",e=e.data[s];t[t.data("replace")?"replaceWith":"html"](J[s+"_"+(e?1<e?"multiple":"one":"zero")].replace("{num}",e))}}),re.ShareWidget=X.extend({tmpl:"shareWidget",render:function(){var e={copyright:"多说分享插件",services:["weibo","qzone","sohu","renren","netease","qqt","kaixin","douban","qq","meilishuo","mogujie","baidu","taobao","google","wechat","diandian","huaban","duitang","youdao","pengyou","facebook","twitter","linkedin","msn"]};this.el.attr("id","ds-share"),this.el.children().attr("id","ds-reset"),this.el.find(".ds-share-aside-inner").html(ie.shareWidget(e)),this.el.find(".ds-share-icons-more").html(ie.shareWidget(e)),this.el.find(".ds-share-icons-more").hide(),this.el.hasClass("flat")&&this.el.find("a").each(function(){q(this).addClass("flat")}),n(this.el),this.delegateEvents()},delegateEvents:function(){var e,t,s,a,i,r,n=this.el;n.children().hasClass("ds-share-inline")?(t=n.find(e=".ds-share-icons-more"),n.delegate(s="[data-toggle=ds-share-icons-more]","mouseover",function(){t.show()}),n.delegate(s,"mouseout",function(){t.hide()}),n.delegate(e,"mouseover",function(){t.show()}),n.delegate(e,"mouseout",function(){t.hide()})):(a=n.children().hasClass("ds-share-aside-left")?"slide-to-right":"slide-to-left",i=n.children(),O.cssProperty("transition")||(r=n.children().hasClass("ds-share-aside-left")?"left":"right",n.delegate(".ds-share-aside-toggle","mouseover",function(){var e={};W.ie6&&"right"==r?e.left=(C.documentElement.scrollLeft+C.documentElement.clientWidth-this.offsetWidth-(parseInt(this.currentStyle.marginLeft,10)||0)-parseInt(this.currentStyle.marginRight,10)||0)-195:e[r]=0,i.animate(e,200)}),n.delegate(".ds-share-aside-inner","mouseleave",function(){var e={};W.ie6&&"right"==r?e.left=(C.documentElement.scrollLeft+C.documentElement.clientWidth-this.offsetWidth-(parseInt(this.currentStyle.marginLeft,10)||0)-parseInt(this.currentStyle.marginRight,10)||0)+230:e[r]=-229,i.animate(e,200)})),n.delegate(".ds-share-aside-toggle,.ds-share-aside-inner","mouseover",function(){i.addClass(a)}),n.delegate(".ds-share-aside-toggle,.ds-share-aside-inner","mouseleave",function(){i.removeClass(a)})),n.delegate("a","click",function(e){var t,s=q(this).data("service");n.data("url")?("wechat"===s?(s=S()+"/api/qrcode/getImage.png",t="?size=240&text="+n.data("url"),B(ie["dialog-qrcode"]({qrcode_url:s+t,url:n.data("url")})).el.find(".ds-dialog").css("width","320px")):(t=S()+"/share-proxy/?"+O.param({service:q(this).data("service"),thread_key:n.data("threadKey"),title:n.data("title"),images:n.data("images"),content:n.data("content"),url:n.data("url")}),g.open(t,"_blank")),e.preventDefault(),e.stopPropagation()):alert("请设置data-url")})}});var v=0;U.initSelector=function(e,r){var n=[];!P()||!q.isReady&&A||q(e).each(function(e,t){var s,a,i=q(t);i.data("initialized")||(i.data("initialized",!0),s=new re[r.type](i,r),ne.push(s),"ThreadCount"===r.type?(t=i.attr("data-thread-key"),i.attr("data-channel-key")&&(t=i.attr("data-channel-key")+":"+t),n.push(t),ue[t]||(ue[t]=new K({})),ue[t].on("reset",function(){s.onload(this)})):s.uri&&(a={},q.each(s.params.split(" "),function(e,t){a[t.replace(/-/g,"_")]=i.attr("data-"+t)||i.data(t)}),H.get(s.uri,u(a),function(e){s.load(e)})))}),n.length&&H.get("threads/counts",u({threads:n.join(",")}),function(e){F(e),O.extend(J,e.options),ue.set(e.response)})},(U.initView=function(){q.each(z,U.initSelector)})(),q(function(){if(!E){if(!P())return R.error("缺少 duoshuoQuery 的定义");R.warn("请在加载多说 embed.js 之前定义 duoshuoQuery")}setInterval(function(){q(".ds-time").each(function(){var e=q(this).attr("datetime");e&&(this.innerHTML=U.elapsedTime(e))})},2e4),E.ondomready&&E.ondomready(),U.initView(),!v&&E.short_name&&H.get("analytics/ping",u({}),F)})})}function fe(e){var t=k[e]?"?"+k[e]+".js":"";return U.STATIC_URL+"/libs/"+e+".js"+t}function me(e){return a[e]||"&amp;"}}(window,document);